<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cottonwood Creek Water Temperature Forecast</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=IBM+Plex+Mono:wght@400;500&display=swap');
:root{
  --bg:#0b1219;--sf:#111c27;--sf2:#172536;--sf3:#1e3044;
  --bd:#243a52;--bdl:#2e4a64;
  --tx:#c4d4e4;--txd:#607d96;--txb:#e6eef6;
  --ac:#29b6f6;--ac2:#81d4fa;
  --gn:#66bb6a;--rd:#ef5350;--or:#ff9800;--yl:#fdd835;--pu:#b39ddb;
  --f:'Source Sans 3',-apple-system,sans-serif;
  --m:'IBM Plex Mono','Consolas',monospace;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--tx);font-family:var(--f);line-height:1.55}

.hdr{background:linear-gradient(160deg,#081018,#0f1e2e 50%,#0b1620);border-bottom:1px solid var(--bd);padding:2rem 2rem 1.7rem;position:relative}
.hdr::after{content:'';position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--ac),transparent);opacity:.3}
.hdr-in{max-width:1280px;margin:0 auto}
.hdr h1{font-size:1.6rem;font-weight:700;color:var(--txb);letter-spacing:-.01em}
.hdr .sub{color:var(--txd);font-size:.9rem;margin-top:.1rem}
.ri{display:flex;gap:1.4rem;margin-top:.55rem;font-size:.76rem;font-family:var(--m);flex-wrap:wrap}
.ri span{color:var(--ac);opacity:.85}

.ab{border-radius:8px;padding:.8rem 1.3rem;margin:1.1rem auto 0;max-width:1280px;display:flex;align-items:center;gap:.65rem;font-weight:500;font-size:.88rem}
.alert-active{background:linear-gradient(90deg,rgba(239,83,80,.18),rgba(239,83,80,.05));border:1px solid rgba(239,83,80,.35)}
.alert-active .adot{width:9px;height:9px;background:var(--rd);border-radius:50%;animation:bk 1.8s infinite}
.alert-active .atx{color:#ef9a9a}
@keyframes bk{0%,100%{opacity:1}50%{opacity:.15}}
.alert-ok{background:linear-gradient(90deg,rgba(102,187,106,.14),rgba(102,187,106,.04));border:1px solid rgba(102,187,106,.25)}
.alert-ok .adot{width:9px;height:9px;background:var(--gn);border-radius:50%}
.alert-ok .atx{color:#a5d6a7}

.ctr{max-width:1280px;margin:0 auto;padding:1rem 2rem 3rem}
.cd{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:1.3rem 1.5rem;margin-bottom:1.1rem}
.cd h3{font-size:.78rem;font-weight:600;color:var(--txd);text-transform:uppercase;letter-spacing:.06em;margin-bottom:.8rem}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:1.1rem}
@media(max-width:960px){.g2{grid-template-columns:1fr}}

.cw{position:relative;width:100%}
.cw canvas{width:100%!important}

.lg{display:flex;gap:1.1rem;flex-wrap:wrap;margin-bottom:.5rem;font-size:.76rem;color:var(--txd)}
.lgi{display:flex;align-items:center;gap:.3rem}
.ll{width:18px;height:3px;border-radius:2px}
.ld{width:18px;height:0;border-top:2px dashed}

.cls{display:flex;gap:0;margin:.25rem 0 .55rem;font-size:.68rem;color:var(--txd)}
.clb{padding:.18rem .55rem;border-radius:3px;margin-right:2px;font-weight:500}

.ws{display:grid;grid-template-columns:repeat(auto-fit,minmax(115px,1fr));gap:.55rem}
.wx-card{background:var(--sf2);border:1px solid var(--bd);border-radius:8px;padding:.85rem .6rem;text-align:center;transition:border-color .2s}
.wx-card:hover{border-color:var(--bdl)}
.wx-card.today-card{border-color:var(--ac);background:var(--sf3)}
.wx-day{font-weight:600;font-size:.8rem;color:var(--txb)}
.wx-date{font-size:.7rem;color:var(--txd);margin-bottom:.35rem}
.wx-icon{font-size:1.9rem;line-height:1.2;margin:.15rem 0}
.wx-cond{font-size:.72rem;color:var(--txd);margin-bottom:.25rem}
.wx-temp{font-size:1.05rem;font-weight:600;color:var(--txb)}
.wx-c{display:block;font-size:.74rem;font-weight:400;color:var(--txd)}
.wx-det{font-size:.65rem;color:var(--txd);margin-top:.2rem;font-family:var(--m)}

table{width:100%;border-collapse:collapse;font-size:.8rem}
th{text-align:left;padding:.5rem .6rem;background:var(--sf2);color:var(--txd);font-weight:500;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid var(--bd);white-space:nowrap}
td{padding:.45rem .6rem;border-bottom:1px solid rgba(36,58,82,.35);font-family:var(--m);font-size:.76rem;white-space:nowrap}
.tdate{font-family:var(--f);font-weight:500}
.tsrc{font-family:var(--f);font-size:.68rem;color:var(--txd)}
.csub{display:block;font-size:.62rem;color:var(--txd);line-height:1.1}
tr.today td{background:rgba(41,182,246,.07)}
tr.today .tdate{color:var(--ac)}
tr.forecast td{color:var(--ac2)}
tr:hover td{background:rgba(41,182,246,.04)}
.cell-alert{background:rgba(239,83,80,.14)!important;color:var(--rd)!important;font-weight:600}
.cell-warn{background:rgba(255,152,0,.12)!important;color:var(--or)!important;font-weight:500}
.cell-caution{background:rgba(253,216,53,.1)!important;color:var(--yl)!important}
.flow-pred{font-size:.6rem;color:var(--ac2);font-style:italic}

.ft{text-align:center;font-size:.7rem;color:var(--txd);padding:1.4rem 2rem;border-top:1px solid var(--bd)}
.model-note{font-size:.68rem;color:var(--txd);margin-top:.3rem;font-style:italic}
</style>
</head>
<body>

<div class="hdr"><div class="hdr-in">
  <h1>Cottonwood Creek Water Temperature Forecast</h1>
  <div class="sub">Monument, Oregon &mdash; MSWCD Gage Station</div>
  <div class="ri">
    <span>Forecast: Wednesday, February 18, 2026</span>
    <span>Temp: Feb 15 &ndash; Feb 25, 2026</span>
    <span>Flow: Feb 11 &ndash; Feb 22 (obs + predicted)</span>
  </div>
</div></div>

<div class="ctr" style="padding-bottom:0">
  <div class="ab alert-ok">
    <div class="adot"></div>
    <div class="atx">Water temperatures are below alert thresholds (23.0&deg;C / 73.4&deg;F).</div>
  </div>
</div>

<div class="ctr">

<!-- WATER TEMP CHART -->
<div class="cd">
  <h3>Water Temperature &mdash; 3-Day Observed + 7-Day Forecast</h3>
  <div class="lg" style="font-size:.85rem;gap:1.5rem;margin-bottom:.7rem">
    <div class="lgi"><div class="ll" style="background:#66bb6a;width:24px;height:4px"></div> <strong style="color:#66bb6a">Observed</strong></div>
    <div class="lgi"><div class="ll" style="background:#29b6f6;width:24px;height:4px"></div> <strong style="color:#29b6f6">Predicted Mouth</strong></div>
    <div class="lgi"><div class="ld" style="border-color:#b39ddb;width:24px;border-top-width:3px"></div> <strong style="color:#b39ddb">Predicted Upstream</strong></div>
    <div class="lgi"><div class="ll" style="background:rgba(239,83,80,.4);height:1px"></div> Alert 23.0&deg;C</div>
  </div>
  <div class="cls">
    <div class="clb" style="background:rgba(79,195,247,.22);color:#4fc3f7">&lt;10&deg;C Cold</div>
    <div class="clb" style="background:rgba(102,187,106,.22);color:#66bb6a">10-18&deg;C Normal</div>
    <div class="clb" style="background:rgba(253,216,53,.18);color:#fdd835">18-21&deg;C Warm</div>
    <div class="clb" style="background:rgba(255,152,0,.18);color:#ff9800">21-23&deg;C High</div>
    <div class="clb" style="background:rgba(239,83,80,.18);color:#ef5350">&ge;23&deg;C Alert</div>
  </div>
  <div class="cw"><canvas id="tempChart" height="220"></canvas></div>
</div>

<!-- FLOW CHART (full width) -->
<div class="cd">
  <h3>Discharge (cfs) &amp; Gage Height (ft) &mdash; 7-Day Observed + 4-Day Predicted</h3>
  <div class="lg">
    <div class="lgi"><div class="ll" style="background:#29b6f6"></div> Observed Flow</div>
    <div class="lgi"><div class="ld" style="border-color:#81d4fa"></div> Predicted Flow</div>
  </div>
  <div class="model-note">Predicted flow uses the trained Random Forest model driven by weather forecast and SNOTEL data from Starr Ridge.</div>
  <div class="cw"><canvas id="flowChart" height="180"></canvas></div>
</div>

<!-- WEATHER CARDS -->
<div class="cd">
  <h3>7-Day Weather Forecast &mdash; Monument, OR</h3>
  <div class="ws">
        <div class="wx-card today-card">
          <div class="wx-day">Today</div>
          <div class="wx-date">Feb 18</div>
          <div class="wx-icon">&#x2601;</div>
          <div class="wx-cond">Cloudy</div>
          <div class="wx-temp">30&deg;F<span class="wx-c">-1&deg;C</span></div>
          <div class="wx-det">RH 75% &middot; DP 23&deg;F</div>
        </div>
        <div class="wx-card">
          <div class="wx-day">Thu</div>
          <div class="wx-date">Feb 19</div>
          <div class="wx-icon">&#x2601;</div>
          <div class="wx-cond">Cloudy</div>
          <div class="wx-temp">29&deg;F<span class="wx-c">-2&deg;C</span></div>
          <div class="wx-det">RH 70% &middot; DP 20&deg;F</div>
        </div>
        <div class="wx-card">
          <div class="wx-day">Fri</div>
          <div class="wx-date">Feb 20</div>
          <div class="wx-icon">&#x2601;</div>
          <div class="wx-cond">Cloudy</div>
          <div class="wx-temp">30&deg;F<span class="wx-c">-1&deg;C</span></div>
          <div class="wx-det">RH 72% &middot; DP 21&deg;F</div>
        </div>
        <div class="wx-card">
          <div class="wx-day">Sat</div>
          <div class="wx-date">Feb 21</div>
          <div class="wx-icon">&#x1F325;</div>
          <div class="wx-cond">Cool</div>
          <div class="wx-temp">34&deg;F<span class="wx-c">1&deg;C</span></div>
          <div class="wx-det">RH 61% &middot; DP 21&deg;F</div>
        </div>
        <div class="wx-card">
          <div class="wx-day">Sun</div>
          <div class="wx-date">Feb 22</div>
          <div class="wx-icon">&#x1F325;</div>
          <div class="wx-cond">Cool</div>
          <div class="wx-temp">40&deg;F<span class="wx-c">4&deg;C</span></div>
          <div class="wx-det">RH 59% &middot; DP 26&deg;F</div>
        </div>
        <div class="wx-card">
          <div class="wx-day">Mon</div>
          <div class="wx-date">Feb 23</div>
          <div class="wx-icon">&#x2601;</div>
          <div class="wx-cond">Cloudy</div>
          <div class="wx-temp">43&deg;F<span class="wx-c">6&deg;C</span></div>
          <div class="wx-det">RH 70% &middot; DP 34&deg;F</div>
        </div>
        <div class="wx-card">
          <div class="wx-day">Tue</div>
          <div class="wx-date">Feb 24</div>
          <div class="wx-icon">&#x2601;</div>
          <div class="wx-cond">Cloudy</div>
          <div class="wx-temp">38&deg;F<span class="wx-c">3&deg;C</span></div>
          <div class="wx-det">RH 72% &middot; DP 30&deg;F</div>
        </div></div>
</div>

<!-- TABLE -->
<div class="cd">
  <h3>Daily Detail (&deg;F with &deg;C below)</h3>
  <div style="overflow-x:auto">
  <table>
    <thead><tr>
      <th>Date</th><th>Src</th><th>Obs Water</th><th>Pred Mouth</th><th>Pred Upstream</th>
      <th>Flow (cfs)</th><th>Gage (ft)</th><th>Air (&deg;F)</th><th>RH (%)</th>
    </tr></thead>
    <tbody>
        <tr class="observed">
          <td class="tdate">Sun Feb 15</td>
          <td class="tsrc">Obs</td>
          <td class="">41.7<span class="csub">5.4&deg;C</span></td>
          <td class="">40.2<span class="csub">4.6&deg;C</span></td>
          <td class="">38.8<span class="csub">3.8&deg;C</span></td>
          <td>174.0</td>
          <td>3.135</td>
          <td>35.8</td>
          <td>95</td>
        </tr>
        <tr class="observed">
          <td class="tdate">Mon Feb 16</td>
          <td class="tsrc">Obs</td>
          <td class="">40.4<span class="csub">4.7&deg;C</span></td>
          <td class="">39.2<span class="csub">4.0&deg;C</span></td>
          <td class="">37.2<span class="csub">2.9&deg;C</span></td>
          <td>175.2</td>
          <td>3.144</td>
          <td>35.2</td>
          <td>87</td>
        </tr>
        <tr class="observed">
          <td class="tdate">Tue Feb 17</td>
          <td class="tsrc">Obs</td>
          <td class="">39.6<span class="csub">4.2&deg;C</span></td>
          <td class="">38.3<span class="csub">3.5&deg;C</span></td>
          <td class="">35.6<span class="csub">2.0&deg;C</span></td>
          <td>175.8</td>
          <td>3.148</td>
          <td>32.6</td>
          <td>76</td>
        </tr>
        <tr class="today">
          <td class="tdate">Today</td>
          <td class="tsrc">Obs</td>
          <td class="">39.0<span class="csub">3.9&deg;C</span></td>
          <td class="">38.0<span class="csub">3.3&deg;C</span></td>
          <td class="">35.3<span class="csub">1.9&deg;C</span></td>
          <td>174.4</td>
          <td>3.137</td>
          <td>30.1</td>
          <td>75</td>
        </tr>
        <tr class="forecast">
          <td class="tdate">Thu Feb 19</td>
          <td class="tsrc">Fcst</td>
          <td class="">--</td>
          <td class="">37.3<span class="csub">3.0&deg;C</span></td>
          <td class="">34.6<span class="csub">1.5&deg;C</span></td>
          <td>176.5 <span class="flow-pred">Pred</span></td>
          <td>3.152 <span class="flow-pred">Pred</span></td>
          <td>28.7</td>
          <td>70</td>
        </tr>
        <tr class="forecast">
          <td class="tdate">Fri Feb 20</td>
          <td class="tsrc">Fcst</td>
          <td class="">--</td>
          <td class="">37.6<span class="csub">3.1&deg;C</span></td>
          <td class="">35.4<span class="csub">1.9&deg;C</span></td>
          <td>176.8 <span class="flow-pred">Pred</span></td>
          <td>3.155 <span class="flow-pred">Pred</span></td>
          <td>29.8</td>
          <td>72</td>
        </tr>
        <tr class="forecast">
          <td class="tdate">Sat Feb 21</td>
          <td class="tsrc">Fcst</td>
          <td class="">--</td>
          <td class="">37.3<span class="csub">3.0&deg;C</span></td>
          <td class="">34.8<span class="csub">1.5&deg;C</span></td>
          <td>176.8 <span class="flow-pred">Pred</span></td>
          <td>3.155 <span class="flow-pred">Pred</span></td>
          <td>33.5</td>
          <td>61</td>
        </tr>
        <tr class="forecast">
          <td class="tdate">Sun Feb 22</td>
          <td class="tsrc">Fcst</td>
          <td class="">--</td>
          <td class="">38.3<span class="csub">3.5&deg;C</span></td>
          <td class="">36.0<span class="csub">2.2&deg;C</span></td>
          <td>177.1 <span class="flow-pred">Pred</span></td>
          <td>3.157 <span class="flow-pred">Pred</span></td>
          <td>39.8</td>
          <td>59</td>
        </tr>
        <tr class="forecast">
          <td class="tdate">Mon Feb 23</td>
          <td class="tsrc">Fcst</td>
          <td class="">--</td>
          <td class="">40.2<span class="csub">4.6&deg;C</span></td>
          <td class="">38.4<span class="csub">3.6&deg;C</span></td>
          <td>177.1 <span class="flow-pred">Pred</span></td>
          <td>3.157 <span class="flow-pred">Pred</span></td>
          <td>42.9</td>
          <td>70</td>
        </tr>
        <tr class="forecast">
          <td class="tdate">Tue Feb 24</td>
          <td class="tsrc">Fcst</td>
          <td class="">--</td>
          <td class="">39.7<span class="csub">4.3&deg;C</span></td>
          <td class="">37.6<span class="csub">3.1&deg;C</span></td>
          <td>177.1 <span class="flow-pred">Pred</span></td>
          <td>3.157 <span class="flow-pred">Pred</span></td>
          <td>38.1</td>
          <td>72</td>
        </tr>
        <tr class="forecast">
          <td class="tdate">Wed Feb 25</td>
          <td class="tsrc">Fcst</td>
          <td class="">--</td>
          <td class="">39.6<span class="csub">4.2&deg;C</span></td>
          <td class="">37.1<span class="csub">2.8&deg;C</span></td>
          <td>177.1 <span class="flow-pred">Pred</span></td>
          <td>3.157 <span class="flow-pred">Pred</span></td>
          <td>36.1</td>
          <td>71</td>
        </tr></tbody>
  </table>
  </div>
</div>

</div>

<div class="ft">Cottonwood Creek Water Temperature Prediction System &bull; Generated 2026-02-18<br>
Models: RF flow (Starr Ridge SNOTEL + Monument Wx) &rarr; Ridge water temperature</div>

<script>
Chart.register(ChartDataLabels);

const LB=['Sun Feb 15', 'Mon Feb 16', 'Tue Feb 17', 'Wed Feb 18', 'Thu Feb 19', 'Fri Feb 20', 'Sat Feb 21', 'Sun Feb 22', 'Mon Feb 23', 'Tue Feb 24', 'Wed Feb 25'], DT=['2026-02-15', '2026-02-16', '2026-02-17', '2026-02-18', '2026-02-19', '2026-02-20', '2026-02-21', '2026-02-22', '2026-02-23', '2026-02-24', '2026-02-25'], TDY="2026-02-18";
const TI=DT.indexOf(TDY);
const AC=23.0, AF=AC*9/5+32;

const MF=[40.2420,39.1533,38.2604,38.0073,37.3344,37.6294,37.3469,38.3455,40.2303,39.7394,39.6002], MC=[4.5789,3.9740,3.4780,3.3374,2.9636,3.1275,2.9705,3.5253,4.5724,4.2996,4.2223];
const UF=[38.8115,37.1984,35.5694,35.3479,34.6428,35.3968,34.7796,36.0253,38.4060,37.5645,37.0781], UC=[3.7842,2.8880,1.9830,1.8600,1.4682,1.8871,1.5442,2.2363,3.5589,3.0914,2.8212];
const OF=[41.7313,40.4206,39.5769,39.0069,null,null,null,null,null,null,null],   OC=[5.4062,4.6781,4.2094,3.8927,null,null,null,null,null,null,null];

/* Flow chart data */
const FLB=['Wed Feb 11', 'Thu Feb 12', 'Fri Feb 13', 'Sat Feb 14', 'Sun Feb 15', 'Mon Feb 16', 'Tue Feb 17', 'Wed Feb 18', 'Thu Feb 19', 'Fri Feb 20', 'Sat Feb 21', 'Sun Feb 22'];
const FDT=['2026-02-11', '2026-02-12', '2026-02-13', '2026-02-14', '2026-02-15', '2026-02-16', '2026-02-17', '2026-02-18', '2026-02-19', '2026-02-20', '2026-02-21', '2026-02-22'];
const FOQ=[181.3358,175.7722,172.5472,171.8147,174.0179,175.2347,175.8159,174.3538,null,null,null,null],  FPQ=[null,null,null,null,null,null,null,174.3538,176.4600,176.7900,176.7900,177.0900];
const FOG=[3.1871,3.1476,3.1244,3.1191,3.1350,3.1438,3.1479,3.1374,null,null,null,null], FPG=[null,null,null,null,null,null,null,3.1374,3.1525,3.1549,3.1549,3.1570];
const FTI=FDT.indexOf(TDY);

const MCL=['#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7'], UCL=['#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7'], OCL=['#4fc3f7','#4fc3f7','#4fc3f7','#4fc3f7','rgba(150,150,150,0.5)','rgba(150,150,150,0.5)','rgba(150,150,150,0.5)','rgba(150,150,150,0.5)','rgba(150,150,150,0.5)','rgba(150,150,150,0.5)','rgba(150,150,150,0.5)'];

const CF={family:"'Source Sans 3'"};
const MO={family:"'IBM Plex Mono'",size:10};
const SD={grid:{color:'rgba(36,58,82,.4)'},ticks:{color:'#607d96',font:{...MO}}};
const TT={backgroundColor:'#172536',borderColor:'#2e4a64',borderWidth:1,titleFont:CF,bodyFont:{family:"'IBM Plex Mono'",size:11},padding:10,cornerRadius:6};

function tzColor(c){
  if(c===null||c===undefined)return null;
  if(c>=23)return 'rgba(239,83,80,0.18)';
  if(c>=21)return 'rgba(255,152,0,0.14)';
  if(c>=18)return 'rgba(253,216,53,0.09)';
  return null;
}

const ZONES={
  id:'zones',
  beforeDatasetsDraw(ch){
    const c=ch.ctx, x=ch.scales.x, y=ch.scales.y;
    if(!x||!y)return;
    const n=LB.length;
    c.save();
    for(let i=0;i<n;i++){
      const temps=[MC[i],UC[i],OC[i]].filter(v=>v!==null&&v!==undefined);
      if(temps.length===0)continue;
      const maxC=Math.max(...temps);
      const col=tzColor(maxC);
      if(!col)continue;
      const cx=x.getPixelForValue(i);
      let left,right;
      if(i===0){ left=x.left; } else{ left=(x.getPixelForValue(i-1)+cx)/2; }
      if(i===n-1){ right=x.right; } else{ right=(cx+x.getPixelForValue(i+1))/2; }
      c.fillStyle=col;
      c.fillRect(left,y.top,right-left,y.bottom-y.top);
      if(maxC>=23){c.fillStyle='rgba(239,83,80,0.35)';c.fillRect(left,y.top,right-left,4);}
    }
    if(TI>=0){
      const px=x.getPixelForValue(TI);
      c.fillStyle='rgba(41,182,246,.025)';c.fillRect(px,y.top,x.right-px,y.bottom-y.top);
      c.strokeStyle='rgba(41,182,246,.25)';c.lineWidth=1;c.setLineDash([5,4]);
      c.beginPath();c.moveTo(px,y.top);c.lineTo(px,y.bottom);c.stroke();c.setLineDash([]);
      c.fillStyle='rgba(41,182,246,.6)';c.font="500 10px 'Source Sans 3'";c.textAlign='center';
      c.fillText('Today',px,y.top-4);
    }
    c.restore();
  },
  afterDatasetsDraw(ch){
    const y=ch.scales.y,x=ch.scales.x;
    if(!y)return;
    const px=y.getPixelForValue(AF);
    if(px<y.top||px>y.bottom)return;
    const c=ch.ctx;c.save();
    c.strokeStyle='rgba(239,83,80,.55)';c.lineWidth=1.5;c.setLineDash([6,4]);
    c.beginPath();c.moveTo(x.left,px);c.lineTo(x.right,px);c.stroke();
    c.fillStyle='rgba(239,83,80,.8)';c.font="600 11px 'Source Sans 3'";c.textAlign='right';
    c.fillText(AC+'\u00b0C Alert',x.right,px-6);c.restore();
  }
};

/* Today divider for flow chart */
const FLOW_TODAY={
  id:'flowToday',
  beforeDatasetsDraw(ch){
    if(FTI<0)return;
    const c=ch.ctx, x=ch.scales.x, y=ch.scales.yF||ch.scales.y;
    if(!x||!y)return;
    c.save();
    const px=x.getPixelForValue(FTI);
    /* Forecast shading */
    c.fillStyle='rgba(41,182,246,.03)';
    c.fillRect(px,y.top,x.right-px,y.bottom-y.top);
    /* Divider line */
    c.strokeStyle='rgba(41,182,246,.3)';c.lineWidth=1;c.setLineDash([5,4]);
    c.beginPath();c.moveTo(px,y.top);c.lineTo(px,y.bottom);c.stroke();c.setLineDash([]);
    /* Label */
    c.fillStyle='rgba(41,182,246,.7)';c.font="500 10px 'Source Sans 3'";c.textAlign='center';
    c.fillText('Today',px,y.top-4);
    /* Predicted zone label */
    c.fillStyle='rgba(129,212,250,.4)';c.font="italic 10px 'Source Sans 3'";c.textAlign='left';
    c.fillText('Predicted \u2192',px+6,y.top+14);
    c.restore();
  }
};

/* ========== WATER TEMP ========== */
new Chart(document.getElementById('tempChart'),{
  type:'line',
  data:{
    labels:LB,
    datasets:[
      {
        label:'Observed (\u00b0F)',data:OF,
        borderColor:'#66bb6a',borderWidth:2.5,
        pointRadius:6,pointHoverRadius:8,pointBackgroundColor:OCL,pointBorderColor:OCL,pointBorderWidth:2,
        tension:.25,fill:false,spanGaps:false,
        datalabels:{
          display:c=>c.dataset.data[c.dataIndex]!==null,
          formatter:(v,c)=>{const cv=OC[c.dataIndex];return cv!==null?cv.toFixed(1)+'\u00b0C':''},
          color:'#a5d6a7',anchor:'end',align:'top',offset:5,
          font:{family:"'IBM Plex Mono'",size:10,weight:500},
        },
      },
      {
        label:'Pred Mouth (\u00b0F)',data:MF,
        borderColor:'#29b6f6',borderWidth:2.5,
        pointRadius:6,pointHoverRadius:8,pointBackgroundColor:MCL,pointBorderColor:MCL,pointBorderWidth:2,
        tension:.25,fill:false,
        datalabels:{
          display:c=>c.dataset.data[c.dataIndex]!==null,
          formatter:(v,c)=>{const cv=MC[c.dataIndex];return cv!==null?cv.toFixed(1)+'\u00b0C':''},
          color:c=>MCL[c.dataIndex],anchor:'end',align:'top',offset:5,
          font:{family:"'IBM Plex Mono'",size:10,weight:500},
        },
      },
      {
        label:'Pred Upstream (\u00b0F)',data:UF,
        borderColor:'#b39ddb',borderDash:[6,3],borderWidth:2,
        pointRadius:5,pointHoverRadius:7,pointBackgroundColor:UCL,pointBorderColor:UCL,pointBorderWidth:2,
        tension:.25,fill:false,
        datalabels:{
          display:c=>c.dataset.data[c.dataIndex]!==null,
          formatter:(v,c)=>{const cv=UC[c.dataIndex];return cv!==null?cv.toFixed(1)+'\u00b0C':''},
          color:c=>UCL[c.dataIndex],anchor:'start',align:'bottom',offset:5,
          font:{family:"'IBM Plex Mono'",size:9,weight:500},
        },
      },
    ],
  },
  options:{
    responsive:true,maintainAspectRatio:true,animation:{duration:500},
    layout:{padding:{top:28,bottom:8}},
    interaction:{mode:'index',intersect:false},
    plugins:{
      legend:{display:false},
      tooltip:{...TT,
        callbacks:{
          label:c=>{const f=c.parsed.y;const cv=(f-32)*5/9;
            return c.dataset.label+': '+f.toFixed(1)+'\u00b0F ('+cv.toFixed(1)+'\u00b0C)'},
        }
      },
    },
    scales:{
      x:{...SD,ticks:{...SD.ticks,maxRotation:45}},
      y:{...SD,position:'left',
        title:{display:true,text:'Temperature (\u00b0F)',color:'#607d96',font:CF},
        afterDataLimits(ax){
          const pad=(ax.max-ax.min)*0.15||5;
          ax.min=ax.min-pad;ax.max=ax.max+pad;
        },
      },
      yC:{
        ...SD,position:'right',grid:{drawOnChartArea:false},
        title:{display:true,text:'Temperature (\u00b0C)',color:'#607d96',font:CF},
        afterBuildTicks(ax){
          const yF=ax.chart.scales.y;
          if(yF){ax.min=(yF.min-32)*5/9;ax.max=(yF.max-32)*5/9}
        },
        ticks:{...SD.ticks,callback:v=>v.toFixed(0)+'\u00b0'},
      },
    },
  },
  plugins:[ZONES],
});

/* ========== FLOW / GAGE (7 obs + 4 pred) ========== */
/* Stage-discharge conversion: Q = 10 * GH^2.5, so GH = (Q/10)^0.4 */
const cfs2ft=q=>q>0?Math.pow(q/10,0.4):0;
const ft2cfs=g=>g>0?10*Math.pow(g,2.5):0;
new Chart(document.getElementById('flowChart'),{
  type:'line',
  data:{
    labels:FLB,
    datasets:[
      /* Observed flow (solid) */
      {
        label:'Observed Flow (cfs)',data:FOQ,
        borderColor:'#29b6f6',backgroundColor:'rgba(41,182,246,.08)',
        borderWidth:2.5,pointRadius:5,pointHoverRadius:7,
        pointBackgroundColor:'#29b6f6',pointBorderWidth:2,
        tension:.25,fill:true,yAxisID:'yF',spanGaps:false,
        datalabels:{
          display:c=>c.dataset.data[c.dataIndex]!==null&&c.dataIndex%2===0,
          formatter:v=>v!==null?v.toFixed(0)+' cfs':'',
          color:'#81d4fa',anchor:'end',align:'top',offset:4,
          font:{family:"'IBM Plex Mono'",size:9,weight:500},
        },
      },
      /* Predicted flow (dashed) */
      {
        label:'Predicted Flow (cfs)',data:FPQ,
        borderColor:'#81d4fa',backgroundColor:'rgba(129,212,250,.06)',
        borderDash:[6,3],borderWidth:2,pointRadius:5,pointHoverRadius:7,
        pointBackgroundColor:'#81d4fa',pointBorderWidth:2,pointStyle:'triangle',
        tension:.25,fill:true,yAxisID:'yF',spanGaps:false,
        datalabels:{
          display:c=>c.dataset.data[c.dataIndex]!==null&&c.dataIndex%2===0,
          formatter:v=>v!==null?v.toFixed(0)+' cfs':'',
          color:'#b3e5fc',anchor:'end',align:'top',offset:4,
          font:{family:"'IBM Plex Mono'",size:9,weight:500,style:'italic'},
        },
      },
    ],
  },
  options:{
    responsive:true,animation:{duration:500},
    layout:{padding:{top:28}},
    interaction:{mode:'index',intersect:false},
    plugins:{legend:{display:false},tooltip:{...TT,
      callbacks:{
        label:c=>{const q=c.parsed.y;const gh=cfs2ft(q);
          return c.dataset.label+': '+q.toFixed(1)+' cfs ('+gh.toFixed(2)+' ft)'},
      }
    }},
    scales:{
      x:{...SD,ticks:{...SD.ticks,maxRotation:45}},
      yF:{...SD,position:'left',title:{display:true,text:'Flow (cfs)',color:'#607d96',font:CF}},
      yG:{...SD,position:'right',grid:{drawOnChartArea:false},
        title:{display:true,text:'Gage Height (ft)',color:'#607d96',font:CF},
        afterBuildTicks(ax){
          const yF=ax.chart.scales.yF;
          if(yF){ax.min=cfs2ft(yF.min);ax.max=cfs2ft(yF.max)}
        },
        ticks:{...SD.ticks,callback:v=>v.toFixed(2)},
      },
    },
  },
  plugins:[FLOW_TODAY],
});
</script>
</body>
</html>